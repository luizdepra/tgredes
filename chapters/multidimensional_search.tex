\chapter{Pesquisa Multidimensional}

	O objetivo da \textit{busca} ou \textit{pesquisa} é recuperar informação a
	partir de uma grande massa de dados previamente armazenada \cite{ziviani}. A
	informação é dividida em registros, sendo que cada registro possui uma chave
	que é usada como critério de pesquisa. Um algoritmo de busca ou pesquisa é
	aquele que recebe uma chave de pesquisa como entrada, retornando os
	registros com chaves iguais à chave de pesquisa. Quando múltiplas chaves de
	pesquisa são utilizadas simultaneamente, a pesquisa é dita multidimensional.

	Este capítulo está organizado da seguinte maneira. Uma visão geral sobre
	pesquisa multidimensional é apresentada na seção \ref{definicoes}. A seção
	\ref{binarias} apresenta as árvores binárias de pesquisa. Logo depois serão
	apresentadas a árvore \textit{K-D} na seção \ref{kd}, a árvore \textit{K-D
	adaptativa} na seção \ref{kdadaptativa} e a árvore \textit{K-D-B} na seção
	\ref{kdb}. Por fim é apresentada a utilização de um banco de dados
	tradicional, o MySQL, para a implementação de pesquisa multidimensional na
	seção \ref{pesquisamultidb}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Definições Preliminares} \label{definicoes}

	Um registro é dito multidimensional quando possui múltiplas chaves, podendo
	ser representado como um ponto no espaço euclidiano. Em termos geométricos,
	um conjunto de chaves pode ser distribuído em um espaço multidimensional,
	onde cada dimensão do espaço corresponde a um atributo. Portanto para $K$
	chaves temos um espaço \textit{K-dimensional}. A pesquisa multidimensional
	retorna todos os registros (pontos) que satisfazem certas características
	\cite{andreas}.

	Estruturas de dados multidimensionais indexam e dão suporte a registros
	multidimensionais. Estas estruturas são comumente conhecidas como métodos de
	acesso multidimensional \cite{gaede}. A pesquisa multidimensional é
	eficiente - logarítmica - se feita com uma estrutura de dados
	multidimensional. Nesse trabalho são apresentadas as seguintes estruturas
	multidimensionais: árvores \textit{K-D}, árvores \textit{K-D adaptativas} e
	árvores \textit{K-D-B}. Antes da descrição dessas estruturas é apresentada a
	árvore binária de pesquisa.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Árvores Binárias de Pesquisa} \label{binarias}

	Uma árvore binária é definida como um conjunto finito de nós que, ou está
	vazio, ou consiste de um nó, chamado raiz, mais os elementos de duas árvores
	binárias distintas chamadas de subárvores esquerda e direita do nó raiz. Em
	uma árvore binária, cada nó tem no máximo duas subárvores \cite{ziviani}.

	Uma árvore binária de pesquisa é uma árvore binária em que todo nó interno
	contém um registro, e, para cada nó, a seguinte propriedade é verdadeira:
	todos os registros com chaves menores estão na subárvore à esquerda e todos
	os registros com chaves maiores estão na subárvore à direita \cite{ziviani}.
	A maior vantagem em utilizar árvores binárias está relacionada à ordenação e
	busca de elementos, operações que são muito eficientes. A figura
	\ref{img_binaria} ilustra um exemplo de árvore binária de pesquisa com 8
	nós, todos ordenados de acordo com sua posição na árvore. Por exemplo, em
	comparação com a chave da raiz, 50, todos os registros da subárvore da
	esquerda têm chaves menores: 33, 12, 40, 47. Analogamente, todos os
	registros da subárvore da direita têm chaves maiores: 55, 66, 77.

\begin{figure}[H] \begin{center} \includegraphics[scale=0.25]{images/binary.jpg}
\caption{Exemplo de árvore binária de pesquisa, com nó raiz 50.}
\label{img_binaria} \end{center} \end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Árvores \textit{K-D}} \label{kd}

	A árvore \textit{K-D} (\textit{K-Dimensional}) \cite{andreas, bentley,
	bentley2} é uma estrutura de dados semelhante à árvore binária, mas que
	permite a busca por múltiplos atributos. Em uma árvore \textit{K-D}, cada nó
	tem $K$ atributos que representam as coordenadas de um ponto no espaço de
	$K$ dimensões.  A árvore \textit{K-D} faz divisões recursivas do espaço em
	subespaços, por meio de hiperplanos de divisão de \textit{K}-dimensões. Por
	exemplo, para \textit{K}=3, os hiperplanos de divisão alternam
	perpendicularmente entre os eixos $x$, $y$ e $z$ \cite{andreas}.

	Em termos de pesquisa, na árvore \textit{K-D}, registros são definidos por
	$K$ chaves. Semelhante ao que ocorre na árvore binária de pesquisa,
	registros são acessados usando as comparações lógicas \textit{menor que} ou
	\textit{maior ou igual que}. Entretando, a chave que determina a sub-árvore
	que será acessada (por exemplo, esquerda ou direita, na árvore binária),
	varia a cada nível da árvore. No nível $L$, a chave $L\ mod (K+1)$ é
	utilizada, sendo que a raiz está no nível 0. Desta maneira, a primeira chave
	de pesquisa é utilizada na raiz, a segunda no nível 1, e assim
	sucessivamente, até que todas as chaves são utilizadas. O processo continua,
	e as chaves são utilizadas de maneira cíclica \cite{andreas}. A figura
	\ref{img_kd} exemplifica o processo: no primeiro nível, só existe o nó raiz
	$A$ e a chave de comparação é a $k_{0}$ (de valor 25). Portanto, os
	descendentes \textit{B e C} serão posicionados de acordo com o valor de sua
	chave $k_{0}$. No caso, $B$ possui chave $k_{0}$ de valor 12, ficando no
	lado esquerdo de $A$ ($12 < 25$). $C$ possuindo chave $k_{0}$ de valor 70,
	fica do lado direito de $A$ ($70 > 25$). No nível seguinte a chave de
	comparação é a $k_{1}$, e no próximo a chave é a $k_{2}$. As chaves são
	utilizadas de maneira cíclica até que todos os pontos estejam representados.

\begin{figure}[H] \begin{center} \includegraphics[scale=0.65]{images/kd.jpg}
\label{img_kd} \caption{Exemplo de árvore \textit{3-D} indexada por 3 chaves
$(k_{0},k_{1},k_{2})$.} \end{center} \end{figure}

	Em árvores \textit{K-D} a operação de pesquisa pode ser feita de três formas
	distintas: pesquisando pelo conjunto de chaves exato, parcial ou dentro de
	um intervalo. A pesquisa exata consiste em percorrer a estrutura procurando
	um registro com exatamente todas as chaves iguais às da pesquisa. A pesquisa
	parcial procura por registros com uma ou mais chaves iguais às da pesquisa.
	E a pesquisa por intervalo localiza todos os registros que tenham suas
	chaves entre os intervalos das chaves da pesquisa. Em todos os casos a forma
	com que o algoritmo percorre a árvore é semelhante ao mesmo algoritmo da
	árvore binária de busca, porém em cada nível da árvore uma chave diferente é
	usada para a comparação.

	A inserção em árvores \textit{K-D} ocorre de forma similar à inserção em
	árvores binárias. O algoritmo percorre a estrutura usando os mesmo critérios
	de percurso do algoritmo de pesquisa até que seja encontrado um nó folha. O
	nó com os novos dados se torna filho do nó folha encontrado, chamado pai. É
	inserido à esquerda se o valor da chave correspondente ao nível for
	\textit{menor que} a chave do nó pai, ou à direita se a chave for
	\textit{maior ou igual que} à chave correspondente do nó pai.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Árvores \textit{K-D Adaptativas}} \label{kdadaptativa}

	A principal desvantagem da árvore \textit{K-D} é o desbalanceamento causado
	pela inserção de elementos. A árvore \textit{K-D adaptativa} \cite{bentley3}
	é uma variação da árvore \textit{K-D}, e resolve o problema do
	desbalanceamento fazendo uma divisão o mais igualitária possível de
	elementos entre cada região. Para determinar o hiperplano que divide um eixo
	é utilizado o algoritmo de Hoare aplicado sobre o conjunto de pontos da
	partição. O algoritmo encontra a mediana sobre o número de pontos na
	partição, garantindo dessa maneira que cada nova partição contenha o mesmo
	número de pontos. Os nós internos armazenam a coordenada de divisão do
	plano, sendo que nós folhas contém a informação. A figura
	\ref{img_kd_adaptative} ilustra esse conceito, um conjunto de 4 pontos em um
	plano, sendo que os hiperplanos de divisão escolhidos dividem igualmente os
	pontos entre as regiões.

\begin{figure}[H] \begin{center}
\includegraphics[scale=0.5]{images/kd_adaptative.jpg} \caption{Exemplo de árvore
\textit{K-D adaptativa}.} \label{img_kd_adaptative} \end{center} \end{figure}

	A árvore K-D adaptativa é uma estrutura estática, sendo difícil mantê-la
	balanceada na presença constante de inserções e remoções. A estrutura
	funciona melhor se os dados são conhecidos a priori e se as atualizações
	forem raras, dependendo assim da ordem de inserção dos dados.

	O algoritmo de pesquisa é executado de maneira parecida com o algoritmo de
	pesquisa da árvore \textit{K-D}. A única diferença é que ao invés de
	utilizar a chave do nó atual para a comparação, é usada a mediana entre
	todos os pontos daquele plano. O algoritmo de inserção para as árvores
	\textit{K-D adaptativas} segue esse mesmo raciocínio, o que faz com que a
	árvore se comporte melhor quando os dados são pouco atualizados.

	As árvores \textit{K-D} são estruturas de dados armazenadas em memória
	primária. Desta forma, não são adequadas para uso em um ambiente com
	armazenamento secundário, onde a estrutura de dados precisa ser paginada
	para ser transferida para a memória primária. Além disso, tanto a árvore
	\textit{K-D} quanto a árvore \textit{K-D adaptativa} tornam-se
	desbalanceadas na presença frequente de inserções e remoções, o que degrada
	o desempenho de busca nessas árvores \cite{andreas}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Árvores \textit{K-D-B}} \label{kdb}

	A árvore \textit{K-D-B} \cite{robinson} é utilizada principalmente para
	armazenamento em memória secundária, possuindo características de árvore
	\textit{K-D adaptativa} e árvore \textit{B} \cite{comer}. A estrutura da
	árvore \textit{K-D-B} segue o mesmo princípio de divisão em planos da árvore
	\textit{K-D adaptativa}, ou seja, os planos são definidos utilizando a
	distribuição de elementos na região.  Porém existe uma diferença fundamental
	entre as árvores \textit{K-D adaptativa} e as árvores \textit{K-D-B}: os nós
	internos são apontadores e representam determinada região. Esses apontadores
	são chamados de \textit{páginas de regiões} e contém o endereço para o nó
	filho ou para uma folha.  Os dados (chamados pontos) são armazenados somente
	nas \textit{páginas de pontos} (folhas), e estas sempre estão em um mesmo
	nível - garantindo que a árvore \textit{K-D-B} esteja sempre balanceada
	\cite{comer}. A figura \ref{img_kdb} mostra um exemplo de árvore
	\textit{2-D-B}, cada nó interno representa uma região retangular e os filhos
	correspondem a partições disjuntas obtidos por divisões recursivas usando
	linhas paralelas ao eixo \textit{x} e \textit{y}. Os pontos são armazenados
	nas folhas da árvore.

\begin{figure}[H] \begin{center} \includegraphics[scale=0.45]{images/kdb.jpg}
\label{img_kdb} \caption{Exemplo de árvore \textit{K-D-B}.} \end{center}
\end{figure}

	Na árvore \textit{K-D-B}, subregiões de um mesmo nível são mutuamente
	disjuntas, isto faz com que a busca por um ponto seja uma simples busca da
	raiz até a folha. Desta maneira é usado o mesmo algoritmo de busca da árvore
	\textit{K-D}. Como a árvore \textit{K-D-B} é balanceada, a complexidade do
	tempo de busca é sempre logarítimica em relação ao número total de elementos
	\cite{andreas}.

	Os algoritmos de pesquisa para a árvore \textit{K-D-B} se dividem em
	pesquisa exata, parcial, por intervalo e por proximidade.

	O algoritmo de pesquisa exata acha um ponto $p$ especificado por $K$
	coordenadas. Esse algoritmo faz  um caminho sobre a árvore até achar a
	página de folha, usando das divisões dos planos até achar ou não o ponto
	exato de pesquisa. Os passos desse algoritmo estão descritos a seguir:

	\begin{verbatim} 
	(L1) Iniciando na página raiz, visitar a página; 
	(L2) Se a página visitada é página folha, então retorna o ponto na página 
	     ou falso caso o ponto não esteja na página; 
	(L3) Senão, enquanto a página visitada for página de região faça: recupera 
	     a página visitada da memória, localiza a página descendente que 
	     intercepta o ponto, faz essa a página a ser visitada e vai para (L2); 
	\end{verbatim}

	O algoritmo de pesquisa por intervalo procura por todos os pontos que
	possuem suas $K$ coordenadas especificadas dentro de um intervalo de
	coordenadas. Esse algoritmo é muito similar ao anterior, porém retorna um ou
	vários pontos dependendo do intervalo escolhido. Os passos para esse
	algoritmo estão descritos abaixo:

	\begin{verbatim} 
	(L1) Iniciando na página raiz, visitar a página; 
	(L2) Se a página visitada é página folha, então retorna todos os pontos na 
	     página que pertencem ao intervalo especificado; 
	(L3) Senão, enquanto a página visitada for página de região faça: recupera 
	     a página visitada da memória, para cada página que intercepta o 
	     intervalo especificado, e caso não seja vazio, faz essa a página a ser 
	     visitada e vai para (L2); 
	\end{verbatim}

	O método de inserção para inserir um ponto $p$ na árvore \textit{K-D-B}
	consiste em localizar a página folha apropriada para o ponto, se existe
	espaço na página folha, $p$ é inserido, caso contrário a página é dividida
	em duas outras.

	A árvore \textit{K-D-B}, na presença de inserções e remoções, pode forçar
	divisões dos blocos de dados. As divisões podem ser propagadas de um nó a
	seus descendentes, para garantir que as regiões permaneçam disjuntas. Uma
	divisão forçada ocorre quando há um \textit{overflow} ou \textit{underflow}
	de uma página, nas operações de inserções ou remoções. Este problema é
	resolvido utilizando a mesma técnica da árvore B, a reorganização. Existem
	dois tipos de reorganização possíveis: a união e a distribuição. No caso da
	união, as informações de duas páginas diferentes são combinadas em uma
	única. E no caso da distribuição, as informações de uma página são divididas
	em duas páginas \cite{andreas}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Pesquisa Multidimensional em Banco de Dados} \label{pesquisamultidb}

	Bancos de dados \cite{bancodedados}, são conjuntos de registros dispostos em
	estrutura regular que possibilitam a reorganização dos mesmos e produção de
	informação. Um banco de dados relacional é um conceito abstrato que define
	maneiras de armazenar, manipular e recuperar dados estruturados unicamente
	na forma de tabelas. A tabela é um conjunto de dados dispostos em número
	finito de colunas e número ilimitado de linhas (ou tuplas). As colunas são
	tipicamente consideradas os campos da tabela, e caracterizam os tipos de
	dados que deverão constar na tabela, por exemplo: numéricos, alfa-numéricos,
	datas, coordenadas, entre outros.

	O número de linhas de uma tabela pode ser interpretado como o número de
	combinações de valores dos campos da tabela sendo, portanto, virtualmente
	ilimitado. Como a maioria das consultas referem-se a uma pequena proporção
	dos registros de um arquivo, são criados índices \cite{indicesMysql} à
	tabela para reduzir o overhead na procura pelos mesmos. Os índices são
	estruturas de dados independentes que armazenam informações referentes às
	chaves indexadas, de forma a referenciar o local onde estão armazenados os
	dados. É comumente utilizada a árvore \textit{B+} \cite{Abraham} para
	armazenar os índices, pois ela apresenta a forma de uma árvore balanceada em
	que todo caminho a partir da raiz da árvore até a folha da árvore possui o
	mesmo tamanho. A pesquisa nesta estrutura de dados é direta e eficiente.
	Porém, a inserção e remoção são mais complexas apresentando um custo
	proporcional ao logaritmo do tamanho do banco de dados na base \textit{N},
	em que cada nó interno armazena \textit{N} ponteiros. Assim a altura de uma
	árvore \textit{B+} é menor que a de outras árvores binárias balanceadas,
	portanto requer menos acessos a disco para localizar registros. A figura
	\ref{img_arvorebmais} mostra um exemplo de árvore \textit{B+}, com um nó
	interno que possui ponteiro para os nós folhas. Cada nó folha possui um
	ponteiro para os dados que aquele índice representa.

\begin{figure}[H] \begin{center}
\includegraphics[scale=0.65]{images/arvorebmais.jpg} \label{img_arvorebmais}
\caption{Exemplo de árvore \textit{B+}.} \end{center} \end{figure}

	O SGBD (Sistema Gerenciador de Banco de Dados) é um conjunto de programas
	responsável pelo gerenciamento de uma base de dados que disponibiliza uma
	interface para incluir, alterar ou consultar dados. Em bancos de dados
	relacionais a interface é constituída pelas APIs (Interface de Programação
	de Aplicativos, do inglês \textit{Application Programming Interface}) ou
	\textit{drivers} do SGBD, que executam comandos na linguagem SQL (Linguagem
	de Consulta Estruturada, do inglês \textit{Structured Query Language}).

	O MySQL \cite{sunmysql} é um SGBD bastante popular, distribuído como
	software livre, que utiliza a linguagem SQL como interface. Nele é possível
	utilizar diversas estratégias para o armazenamento dos dados, estas
	estratégias são chamadas de \textit{Storage Engine} \cite{StorageEngine}
	estão entre elas o \textit{MyISAM} (padrão do MySQL). Com o \textit{MyISAM} 
	é possível a criação de índices com múltiplas chaves (até 15 chaves).

	Como todo SGBD, o MySQL utiliza índices para otimizar as buscas, do
	contrário seria necessário realizar uma busca seqüencial dos dados,
	iniciando pelo primeiro registro e lendo seqüencialmente através de toda a
	tabela até encontrar todos os registros relevantes. Se a tabela possuir
	índices para as colunas em questão, o MySQL pode rapidamente obter uma
	posição para procurar, a partir de qualquer ponto do arquivo de dados sem
	ter que varrer todos os registros sequencialmente \cite{indicesMysql}.

