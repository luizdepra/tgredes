\chapter{Pesquisa Multidimensional}

	O objetivo da pesquisa é recuperar informação a partir de uma grande massa de informação previamente armazenada. A informação é dividida em registros, em que cada registro possui uma chave para ser usada na pesquisa \cite{ziviani}. Um algoritmo de pesquisa ou busca é aquele que recebe uma chave de pesquisa como entrada, retornando os registros com chaves iguais a chave de pesquisa.

	Algumas definições sobre pesquisa multidimensional estão na seção \ref{definicoes}. A seção \ref{binarias} apresenta as árvores binárias de busca. Logo depois serão apresentadas em detalhes a árvore \textit{K-D} na seção \ref{kd} e a árvore \textit{K-D-B} na seção \ref{kdb}. Por fim é apresentada a utilização de um banco de dados tradicional, o \textit{MySQL} para a implementação de pesquia multidimensional na seção \ref{pesquisamultidb}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Definições Preliminares}
\label{definicoes}

	Um registro é dito multidimensional quando possui múltiplas chaves, podendo ser representado como um ponto no espaço euclidiano. Em termos geométricos, um conjunto de chaves pode ser distribuído em um espaço multidimensional, onde cada dimensão do espaço corresponde a um atributo. Portanto para $k$ chaves temos um espaço \textit{k-dimensional}. Uma consulta multidimensional retorna todos os registros (pontos) que satisfazem certas características \cite{andreas}. 
	
	A operação de consulta multidimensional é muito mais eficiente se feita em uma estrutura de dados multidimensional. Estruturas de dados multidimensionais indexam e dão suporte a registros multidimensionais. Estas estruturas são comumente conhecidas como métodos de acesso multidimensional \cite{gaede}. Nesse trabalho são apresentadas as seguintes estruturas multidimensionais: árvores \textit{K-D} e \textit{K-D-B}. Ambas são baseadas na árvore binária de pesquisa, a qual será apresentada a seguir. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Árvores Binárias de Pesquisa}
\label{binarias}

	Uma árvore binária é definida como um conjunto finito de nós que ou está vazio ou consiste de um nó chamado raiz mais os elementos de duas árvores binárias distintas chamadas de subárvores esquerda e direita do nó raiz. Em uma árvore binária, cada nó tem no máximo duas subárvores \cite{ziviani}.

	Uma árvore binária de pesquisa é uma árvore binária em que todo nó interno contém um registro, e, para cada nó, a seguinte propriedade é verdadeira: todos os registros com chaves menores estão na subárvore a esquerda e todos os registros com chaves maiores estão na subárvore a direita \cite{ziviani}. A maior vantagem em utilizar árvores binárias está relacionada a ordenação e busca de elementos que são muito eficientes. As árvores binárias de pesquisa servem de base para as estruturas multidimensionais descritas a seguir (árvores \textit{K-D} e \textit{K-D-B}).

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.25]{images/binary.jpg}
\caption{Árvore binária de pesquisa.} 
\end{center}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Árvores \textit{K-D}}
\label{kd}

	A árvore \textit{K-D} \cite{andreas, bentley, bentley2} é uma estrutura de dados semelhante à árvore binária, mas que permite a busca por múltiplos atributos. Em uma árvore \textit{K-D}, cada nó tem $K$ atributos que representam as coordenadas de um ponto no espaço de $K$ dimensões.  A árvore \textit{K-D} faz divisões recursivas do espaço em subespaços, por meio de hiperplanos de divisão de k-dimensões. Por exemplo, para k=3, os hiperplanos de divisão alternam perpendicularmente entre os eixos x, y e z \cite{andreas}.

	Na árvore \textit{K-D}, registros são definidos por $k$ chaves de pesquisa. Semelhante ao que ocorre na árvore binária de pesquisa, registros são acessados usando comparações lógicas menor que ou maior igual que. Entretando, a chave que determina a sub-árvore que será acessada (por exemplo, esquerda ou direita, na árvore binária), varia a cada nível da árvore. No nível $L$, a chave $L\ mod (k+1)$ é utilizada, sendo que a raiz está no nível 0. Desta maneira, a primeira chave de pesquisa é utilizada na raiz, a segunda no nível 1, e assim sucessivamente, até que todas as chaves são utilizadas. O processo continua, e as chaves são utilizadas de maneira cíclica \cite{andreas}.

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.3]{images/kd.jpg}
\caption{Árvore \textit{K-D}.} 
\end{center}
\end{figure}

%	A pesquisa em uma árvore K-D 

%	A inserção de um registro na árvore \textit{K-D} é feita a partir da pesquisa da chave até que um ponteiro nulo seja encontrado, indicando o local para a inserção do novo registro.

%	Construir uma árvore K-D estática a partir de n pontos tem complexidade de tempo O(n log n).
	
%	Inserir um novo registro em uma árvore K-D balanceada leva O(log n) de tempo.

%	A remoção de um ponto de uma árvore K-D balanceada tem complexidade O(log n).

\section{Árvores \textit{K-D adaptativas}}

	A principal desvantagem da árvore \textit{K-D} é o desbalanceamento causado pela inserção de elementos. A árvore \textit{K-D adaptativa} \cite{bentley3} é uma variação da árvore \textit{K-D}, e resolve o problema do desbalanceamento fazendo uma divisão mais igualitária possível de elementos entre cada região. Para determinar o hiperplano que divide um eixo é utilizado o algoritmo de Hoare aplicado sobre o conjunto de pontos da partição. O algoritmo encontra a mediana sobre o número de pontos na partição, garantindo dessa maneira que cada nova partição contenha o mesmo número de pontos. Os nós internos armazenam a coordenada de divisão do plano, sendo que nós folhas contém a informação.

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{images/kd_adaptative.jpg}
\caption{Árvore \textit{K-D adaptativa}. O hiperplano não é definido pela coordenada do plano.} 
\end{center}
\end{figure}

	A árvore K-D adaptativa é uma estrutura estática, sendo difícil mantê-la balanceada na presença constante de inserções e remoções. A estrutura funciona melhor se os dados são conhecidos a priori e se as atualizações forem raras, dependendo assim da ordem de inserção dos dados. 

	As árvores \textit{K-D} são estruturas de dados armazenadas em memória primária, assim sendo não possuem um bom desempenho em um ambiente com armazenamento secundário, onde a estrutura de dados precisa ser paginada para ser transferida para a memória primária . Tanto a árvore \textit{K-D} quanto a \textit{K-D adaptativa} tornam-se desbalanceadas na presença frequente de inserções e remoções, o que degrada o desempenho de busca nessas árvores \cite{andreas}. .

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Árvores \textit{K-D-B}}
\label{kdb}

	A árvore \textit{K-D-B} é utilizada principalmente para armazenamento em memória secundária, possuindo características de árvore \textit{K-D adaptativa} e árvore \textit{B} \cite{andreas}. A estrutura da árvore \textit{K-D-B} segue o mesmo princípio de divisão em planos da árvore \textit{K-D}, ou seja, os planos são definidos utilizando a distribuição de elementos na região.
	Porém existe uma diferença fundamental entre as árvores \textit{K-D adaptativa} e as árvores \textit{K-D-B}: os nós internos são apontadores e representam determinada região. Esses apontadores são chamados de \textit{páginas de regiões} e contém o endereço para o nó filho ou para uma folha.
	Os pontos são armazenados somente nas \textit{páginas de pontos} (folhas), e estas sempre estão em um mesmo nível - garantindo que a árvore \textit{K-D-B} esteja sempre balanceada \cite{comer}.

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.30]{images/kdb.jpg}
\caption{Árvore \textit{K-D-B}.} 
\end{center}
\end{figure}

	Na árvore \textit{K-D-B}, subregiões de um mesmo nível são mutuamente disjuntas, isto faz com que a busca por um ponto seja uma simples busca da raiz até a folha. Desta maneira usa-se o mesmo algoritmo de busca da árvore \textit{K-D}, e a complexidade do tempo de busca é logarítima em relação ao número de elementos total \cite{andreas}.

	A árvore \textit{K-D-B}, na presença de inserções e remoções pode forçar divisões dos blocos de dados. As divisões podem ser propagadas de um nó a seus descendentes, para garantir que as regiões permaneçam disjuntas. Uma divisão forçada ocorre quando há um \textit{overflow} ou \textit{underflow} de uma página, nas operações de inserções ou remoções. Este problema é resolvido utilizando a mesma técnica utilizada na árvore B, a reorganização. Existem dois tipos de reorganização possíveis: a união e a distribuição. No caso da união, as informações de duas páginas diferentes são combinadas em uma única. E no caso da distribuição, as informações são divididas entre duas páginas \cite{andreas}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Pesquisa Multidimensional em Banco de Dados}
\label{pesquisamultidb}

	Banco de Dados\cite{bancodedados}, são conjuntos de registros dispostos em estrutura regular que possibilita a reorganização dos mesmos e produção de informação.

	Um Banco de Dados Relacional\cite{bancodedadosrelacional} é um conceito abstrato que define maneiras de armazenar, manipular e recuperar dados estruturados unicamente na forma de tabelas.

	A tabela\cite{tabela} é um conjunto de dados dispostos em número finito de colunas e número ilimitado de linhas (ou tuplas). As colunas são tipicamente consideradas os campos da tabela, e caracterizam os tipos de dados que deverão constar na tabela (numéricos, alfa-numéricos, datas, coordenadas, etc). O número de linhas pode ser interpretado como o número de combinações de valores dos campos da tabela que é virtualmente ilimitado, o que torna as pesquisas por valor potencialmente muito lentas. Para permitir agilizar estas consultas, podem ser associados índices à tabela, que são estruturas de dados independentes da forma e ordem como estão armazenados os dados, embora tenham relação direta com os mesmos. Como consequência, a cada alteração de dados, irá corresponder uma (ou mais) alterações em cada um dos índices, aumentando o esforço necessário ao Sistema Gerenciador de Banco de Dados (SGBD) para realizar essa alteração.

	O Sistema Gerenciador de Banco de Dados (SGBD) é um conjunto de programas de computador responsável pelo gerenciamento de uma base de dados que disponibiliza interface para incluir, alterar ou consultar dados. Em bancos de dados relacionais a interface é constituída pelas APIs ou drivers do SGBD, que executam comandos na linguagem SQL.
 
	O \cite{sunmysql} e um SGBD bastante popular distribuído como software livre que utiliza a linguagem SQL (Linguagem de Consulta Estruturada, do inglês \textit{Structured Query Language}) como interface, apresenta diversas arquiteturas responsáveis por manter o armazenamento dos dados e tabelas (Storage Engine) como MyISAM(\textit{Storage Engine} padrão do mysql), MEMORY(HEAP), InnoDB entre outras, possibilita a criação de indices com multiplas chaves (até 15 chaves). Sem um índice o MySQL tem de iniciar com o primeiro registro e depois ler através de toda a tabela até que ele encontre os registros relevantes. Quanto maior a tabela, maior será o custo. Se a tabela possui um índice para as colunas em questão, o MySQL pode rapidamente obter uma posição para procurar no meio do arquivo de dados sem ter que varrer todos os registros.\cite{indicesMysql}
