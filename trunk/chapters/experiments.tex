\chapter{Experimentos}

	Nesse capítulo são descritos os experimentos realizados para comparação do uso de árvores multidimensionais com o MySQL na manipulação de dados multidimensionais. Na seção \ref{config_experiments} é descrita a máquina utilizada para os experimentos, tanto em nível de hardware quanto de software. A seção \ref{impl_decisions} justifica e apresenta as decisões de implementação. E finalmente, os experimentos foram divididos em duas partes: a seção \ref{kd_vs_mysql} apresenta os experimentos de comparação entre árvores \textit{K-D} e MySQL para monitoramento \textit{online}, seguida da seção \ref{kdb_vs_mysql} a qual apresenta os experimentos de comparação entre árvores \textit{K-D-B} e MySQL para monitoramento \textit{offline}.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Configurações e Ambiente de Experimentação}
\label{config_experiments}
	
	Para a realização dos experimentos de comparação, foi utilizada uma máquina dedicada somente para esta atividade. A configuração de hardware dessa maquina é a seguinte: processador AMD Athlon XP 1800+, dois módulos de memória DDR 400 de 512MB e disco \textit{Saunsung} 40GB, 7200RPM.

	O sistema operacional utilizado é o Debian Lenny, com kernel linux 2.6.26. Todas as implementações relativas aos experimentos utilizam-se de ferramentas ou bibliotecas de código aberto. Para a implementação da árvore \textit{K-D} foi utilizada a biblioteca libkdtree++ \cite{libkdtree}, a qual possui todas as operações necessárias. A árvore \textit{K-D-B} foi implementada a partir da biblioteca TPIE \cite{tpie}, a qual provê vários mecanismos para trabalhar com a memória secundária com abstrações de alto nível.	As versões das bibliotecas utilizadas são as seguintes: libkdtree++ 0.7.0, tpie release '091905' e MySQL 5.0.51.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Decisões de Implementação}
\label{impl_decisions}

	Os experimentos de comparação envolvem várias ferramentas distintas, e portanto, várias decisões de padronização foram tomadas. 
	
	A decisão inicial foi na estratégia de medição do tempo para as operações de inserção e busca. Como todas as ferramentas utilizam de \textit{C} ou \textit{C++}, foi escolhido um algoritmo para medição do tempo, o qual usa a função \textit{clock()} disponível na biblioteca \textit{time.h}. Com essa função é possível alcançar a precisão de milisegundos, porém essa medida não é totalmente precisa - visto que foi amostrada em um sistema linux multitarefas. O número de registros (dados multidimensionais) que foram usados nos experimentos variam de 16000, 100000, 250000, 500000, 1000000, 2000000, 4000000, e 8000000. 
	
	O tipo do arquivo de entrada a ser usado (texto ou binário) foi uma decisão tomada empiricamente. Nesse experimento, comparamos a árvore \textit{K-D} com o \textit{MySQL} tanto para a operação de inserção quanto de busca. Para a simplificação do experimento, os testes foram feitos somente com dados multidimensionais de 4 chaves. No MySQL, utilizamos somente arquivo de entrada texto e na árvore \textit{K-D} foram usados o arquivo de entrada texto e binário.
			
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.6]{images/experiments/4keys_insertion_kdtree_mysql.jpg}
\caption{Árvore \textit{K-D} vs MySQL: inserção.}
\label{img_insert_4keys_kd_mysql}
\end{center}
\end{figure}

	Na figura \ref{img_insert_4keys_kd_mysql} é possível visualizar os resultados obtidos na comparação entre árvore \textit{K-D} e MySQL para a inserção. Nesse gráfico de resultados, o MySQL possui um crescimento linear muito maior que a árvore \textit{K-D}. Além disso, é possível verificar que para a árvore \textit{K-D} a inserção de dados multidimensionais com arquivo texto tem um tempo levemente inferior em relação ao arquivo binário. Como o tempo é o parâmetro de comparação em todos os experimentos, a árvore \textit{K-D} com arquivo de entrada texto obteve desempenho superior.

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.6]{images/experiments/4keys_search_kdtree_mysql.jpg}
\caption{Árvore \textit{K-D} vs MySQL: busca.} 
\label{img_search_4keys_kd_mysql}
\end{center}
\end{figure}

	A operação de busca para comparação entre árvores \textit{K-D} e MySQL tem seus resultados apresentados na figura \ref{img_search_4keys_kd_mysql}. É possível visualizar novamente o crescimento linear muito maior no MySQL do que na árvore \textit{K-D}. Além disso, apesar de não ficar visível no gráfico, a árvore \textit{K-D} com arquivo de entrada texto teve desempenho superior novamente.
	
	Nesses dois experimentos foram utilizados os dois tipos de arquivo: binário e texto. A escolha para o resto dos experimentos foi pelo formato que gerava menos carga sobre o sistema, ou seja, o arquivo texto. Apesar disso, o espaço ocupado em disco pelos arquivos binários é aproximadamente a metade do espaço ocupado pelo arquivo texto equivalente. Uma observação que deve ser feita é que nesse experimento não houve nenhum tipo de otimização no MySQL. O formato do arquivo de entrada também foi definido nesse mesmo experimento - cada linha representa um dado multidimensional, sendo que cada coluna representa uma dimensão desse dado. A partir desse ponto, todos os experimentos foram feitos com cinco bases diferentes, sendo que o valores que aparecem nos gráficos são uma média das cinco medições.

	As bases de arquivos, que possuem os dados multidimensionais são comuns entre as ferramentas. Esses dados de entrada utilizados nos experimentos não são originados de monitoramento de redes reais. São dados gerados randomicamente através de um programa, o qual coloca em arquivo na forma de texto ou binário para que sejam utilizados posteriormente pelas ferramentas. Mesmo que a origem dos dados seja randômica, isso não afetaria o resultado em nenhum aspecto, visto que seriam dados de mesma natureza.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Árvore \textit{K-D} vs MySQL}
\label{kd_vs_mysql}
	
	A libkdtree++ possui todas as operações de inserção e busca implementadas, sendo que para os experimentos de busca foi escolhido uma busca por intervalo. Esse intervalo é de 5, e o valor pelo qual varia é 50. Ou seja, valores de chaves entre 45 e 55 seriam filtrados. Porém, a operação é de pesquisa multidimensional e um exemplo de registro com 4 chaves que seria selecionado é \{45, 47, 54, 50\}.

	A motivação para experimentos de comparação entre árvores \textit{K-D} e MySQL é o monitoramento \textit{online}. O monitoramento \textit{online} consiste em ir construindo a estrutura multidimensional na medida em que os dados são monitorados. Essa seção está dividida em duas partes: A subseção \ref{kd_vs_mysql_insert} trata dos experimentos envolvendo a operação de inserção, e a subseção \ref{kd_vs_mysql_search} trata dos experimentos envolvendo a operação de busca.

\subsection{Árvore \textit{K-D} vs MySQL: Inserção}
\label{kd_vs_mysql_insert}

	Para o experimento de comparação da inserção entre a árvore \textit{K-D} e o MySQL, as chaves variam de 4, 8 e 16.

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.6]{images/experiments/Xkeys_insertion_kdtree_mysql.jpg}
\caption{Árvore \textit{K-D} vs MySQL: inserção. Chaves variando de 4, 8 e 16.}
\label{img_insert_Xkeys_kd_mysql}
\end{center}
\end{figure}

	A figura \ref{img_insert_Xkeys_kd_mysql} ilustra os resultados desse experimento. Pode-se observar que tanto na árvore \textit{K-D} quanto no MySQL o crescimento é linear conforme aumentam o número de chaves. Porém, é possível visualizar a grande diferença absoluta entre a árvore \textit{K-D} e o MySQL. Por exemplo, com 8 milhões de registros e 16 chaves, o MySQL fez a inserção em 20 minutos enquanto que a árvore \textit{K-D} fez a inserção em 1 minuto e 43 segundos.  
	
\subsection{Árvore \textit{K-D} vs MySQL: Busca}
\label{kd_vs_mysql_search}
	
	Para esse experimento de comparação de busca entre árvore \textit{K-D} e o MySQL, as chaves variam de 4, 8 e 16.

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.6]{images/experiments/Xkeys_search_mysql.jpg}
\caption{MySQL: busca. Chaves variando de 4, 8 e 16.}
\label{img_search_Xkeys_mysql}
\end{center}
\end{figure}

	O gráfico de busca da árvore \textit{K-D} foi omitido pois, em todos os testes, o tempo de retorno foi de 0ms até 2ms. Ou seja, não apareceria nenhuma linha no gráfico de comparação. A figura \ref{img_search_Xkeys_mysql} mostra o tempo para a busca no MySQL, com chaves variando entre 4, 8 e 16. Observa-se que a partir de 2 milhões de registros e 16 chaves, o MySQL acentua a sua curva de crescimento em muito mais do que seria o padrão esperado.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Árvore \textit{K-D-B} vs MySQL}
\label{kdb_vs_mysql}

	Monitoramento OFFLINE

	Como o uso da biblioteca da árvore \textit{K-D-B} é mais restrita, os experimentos utilizam somente chaves de tamanho 10.

\subsection{Árvore \textit{K-D-B} vs MySQL: Inserção}

	A figura \ref{img_insert_10keys_kdb_mysql} mostra a comparação entre a árvore \textit{K-D-B} e o MySQL. Um detalhe é que foi utilizado de indexação variando de 0 a 10 no MySQL.

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.6]{images/experiments/10keys_insertion_kdbtree_mysql.jpg}
\caption{Árvore \textit{K-D-B} vs MySQL: Inserção}
\label{img_insert_10keys_kdb_mysql}
\end{center}
\end{figure}

\subsection{Árvore \textit{K-D-B} vs MySQL: Inserção Otimizada}

	Nesse experimento foi utilizada uma forma de inserção otimizada do MySQL, através da operação LOAD IN FILE \cite{mysqlLIF}. A figura \ref{img_insert_10keys_kdb_mysql_2} mostra o resultado dessa otimização no MySQL.

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.6]{images/experiments/10keys_insertion_kdbtree_mysql2.png}
\caption{Árvore \textit{K-D-B} vs MySQL}
\label{img_insert_10keys_kdb_mysql_2}
\end{center}
\end{figure}

\subsection{Árvore \textit{K-D-B} vs MySQL: Busca}

	A comparação da busca entre a árvore \textit{K-D-B} e o MySQL com índices estão na figura \ref{img_search_10keys_kdb_mysql}.

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.6]{images/experiments/10keys_search_kdbtree_mysql.jpg}
\caption{Árvore \textit{K-D-B} vs MySQL: Busca}
\label{img_search_10keys_kdb_mysql}
\end{center}
\end{figure}
